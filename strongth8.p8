pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
c={0,1,2,8,14,15,7}
fillp(0xa5a5)
timer = 0

function _init()
 titleinit()
 resettimer()
end

function titleinit()
 scene = 0
end

function gameinit()
 scene = 1
end

function titleupdate()
 if(btnp(5)) then
  gameinit()
 end
end

function resettimer()
 timer = rnd(210)
end

function gameupdate()
 timer -= 1
 -- check for input
 if(btnp(5)) and timer < 0 then
  scene += 1
  resettimer()
 end

 if timer < -15 then
  -- todo add fail screen
  scene = 0
  resettimer()
 end

 if scene > 4 then
  -- todo victory screen
  scene = 0
  resettimer()
 end
end

function f(i)
 return c[flr(1.5+abs(6-i%12))]
end

function tunnel()
 -- tunnel animation "borrowed" from luca harris
 -- from this tweet https://twitter.com/lucatron_/status/1096168653735657472
 for w=3,68,.1 do
  a=4/w+t()/4
  k=145/w
  x=64+cos(a)*k
  y=64+sin(a)*k
  i=35/w+2+t()*3
  rect(x-w,y-w,x+w,y+w,f(i)*16+f(i+.5))
 end
end

function titledraw()
 tunnel()
 print("press x after the flash", 17, 60, 12)
 print("press x to start game", 20, 70, 12)
end

function gamedraw()
 -- clear screen and draw player
 cls(1)
 spr(16,10,58,2,2)

 -- figure out which enemy to draw
 if scene == 1 then
  spr(18,100,58,2,2)
 elseif scene == 2 then
  spr(20,100,58,2,2)
 elseif scene == 3 then
  spr(22,100,58,2,2)
 elseif scene == 4 then
  spr(8,80,40,4,4)
 end

 if timer <= 0 and timer >= -2 then
  cls(7)
 end
end

function _update()
 if scene == 0 then
  titleupdate()
 else
  gameupdate()
 end
end

function _draw()
 if scene == 0 then
  titledraw()
 else
  gamedraw()
 end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000022222222222222222222222222220000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000222222229222222222222222222222000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000002222222299222222222222992222222200000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000002222222229222222222229922222222200000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000002222222299992222222229222222222200000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000002222222999892222222229222222222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000002222229999892222222299922222222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000002222229988992222229999992222222200000000000000000000000000000000
0eeeeeeeeeeeeee008a80000000088a0cccccccccccccccc99999999999999992222229998822222222998992222222200000000000000000000000000000000
eeeeeeeeeeeeeeee21aa3000000381aacccccccccccccccc99999999999999992222229888892222222998992222222200000000000000000000000000000000
eeeeeeeeeeeeeeee2112bb3333bb8112ccccccc1cccccccc99991999999999992222299878992222229987899922222200000000000000000000000000000000
eeeee0eeeeeee0ee211bbbbbbbbbb112cccc1cc1c11ccccc99999999999919992222299878992222999887889922222200000000000000000000000000000000
eeeeeeeeeeeeeeee0bbbbbbbbbbbbbb0ccccccc11cc1cccc99999999999999992222299999992222999998889922222200000000000000000000000000000000
eeeeeeeeeeeeeeee0bbffffffffffbb0cccccccccccccccc99999911199999992222222299222222229999999222222200000000000000000000000000000000
eeeeeeeeeeeeee0e00ffffffffffff00ccccccccccc1cccc99999119119999992222222222222222222222222222222200000000000000000000000000000000
ee0eeeeeeeeeee0e000ffffffffff000ccccccccc1cccccc99999199919999992222222222222222222222222222222200000000000000000000000000000000
ee00eeeeeeeee0ee0003999999993000cccccc1111cccccc99991999919999992222222221111111111222222222222200000000000000000000000000000000
eee0eeeeeeee00ee000b99999999b000ccccc1ccc1cccccc99991999911999992222222217777777771122222222222200000000000000000000000000000000
eee00eeeeee00eee033bffffffffb330cccc1ccccc1ccccc99991999991999992222222117777777777111222222222200000000000000000000000000000000
eeee0000000eeeee33bbffffffffbb33cccc1ccccc1ccccc99991199991999992222222111777771777111122222222200000000000000000000000000000000
eeeeeeeeeeeeeeee33888ffffff88833cccccccccccccccc99999199991999992222222111771771177111112222222200000000000000000000000000000000
eeeeeeeeeeeeeeee2888888ff8888882cccccccccccccccc99999111991999992222222111111711111111112222222200000000000000000000000000000000
eeeeeeeeeeeeeeee2288288338828822cccccccccccccccc99999991111999992222222111111111111111111222222200000000000000000000000000000000
0eeeeeeeeeeeeee00022022332202200cccccccccccccccc99999999999999992222222211111111111111111222222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000002222222211111111111111111222222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000002222222211111111111111111122222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000002222222211111111111111111122222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000002222222222222222222222211122222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000002222222222222222222222222222222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000002222222222222222222222222222222200000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000222222222222222222222222222222000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000022222222222222222222222222220000000000000000000000000000000000
